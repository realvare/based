<div align="center">

# ğŸŒŒ Based - by Sam aka vare


<p align="center">
Â  <img src="https://img.shields.io/badge/Licenza-MIT-8a2be2.svg?style=for-the-badge&labelColor=2d1b69" alt="Licenza: MIT"/>
Â  <img src="https://img.shields.io/github/stars/realvare/based?style=for-the-badge&color=8a2be2&labelColor=2d1b69" alt="GitHub stelle"/>
Â  <img src="https://img.shields.io/github/forks/realvare/based?style=for-the-badge&color=8a2be2&labelColor=2d1b69" alt="GitHub Forks"/>
</p>
<div align="center">
<p align="center">
Â  <strong>ğŸ’œ Una libreria WhatsApp Web API moderna, potente e veloce con supporto avanzato per LID/JID</strong>
</p>

<p align="center">
Â  <a href="#-caratteristiche-principali">Caratteristiche</a> â€¢
Â  <a href="#-installazione">Installazione</a> â€¢
Â  <a href="#-guida-rapida">Guida Rapida</a> â€¢
Â  <a href="#-documentazione-api">Documentazione API</a> â€¢
Â  <a href="#-messaggi-interattivi-e-bottoni">Messaggi Interattivi</a> â€¢
Â  <a href="#-fix-lidjid">Fix LID/JID</a> â€¢
Â  <a href="#-configurazione-avanzata">Configurazione Avanzata</a> â€¢
Â  <a href="#-supporto-e-community">Supporto</a>
</p>

</div>

---

## âœ¨ Caratteristiche Principali

Questa libreria, basata su Baileys con miglioramenti specifici, offre un'API intuitiva per interagire con WhatsApp Web. Ecco un riassunto delle funzionalitÃ  chiave:

| Categoria | Dettagli |
|-----------|----------|
| **Core Features** | - ğŸ”„ Mappatura intelligente `@lid` e `@s.whatsapp.net` (JID)<br>- ğŸ“± Supporto multi-dispositivo completo<br>- ğŸ”’ Crittografia End-to-End nativa (Protocollo Signal)<br>- âš¡ Codebase TypeScript moderna e ottimizzata |
| **Messaggi e Interazioni** | - ğŸ’¬ Gestione avanzata di messaggi testo, media e interattivi<br>- ğŸ›ï¸ Supporto per bottoni, liste, carousel e template<br>- ğŸ–¼ï¸ Invio di album, poll e reazioni |
| **Developer Experience** | - ğŸ“¡ Eventi real-time per connessioni e messaggi<br>- ğŸ›¡ï¸ Tipizzazioni TypeScript complete<br>- ğŸ“– Documentazione estesa con esempi<br>- ğŸ”§ API semplici e estendibili |

---

## ğŸš€ Guida Rapida

Inizia creando un bot semplice. Questa sezione include esempi base per l'autenticazione e la gestione delle connessioni.

### Esempio Base - Avvio Bot

```typescript
import makeWASocket, { DisconnectReason, useMultiFileAuthState, getPerformanceConfig, setPerformanceConfig } from 'based';

// Configura performance e cache
setPerformanceConfig({
Â  Â  performance: {
Â  Â  Â  Â  enableCache: true,
Â  Â  Â  Â  enableMetrics: true
Â  Â  },
Â  Â  debug: {
Â  Â  Â  Â  enableLidLogging: true,
Â  Â  Â  Â  logLevel: 'info'
Â  Â  }
});

async function startBot() {
Â  // ğŸ” Setup autenticazione multi-file per sessioni persistenti
Â  const { state, saveCreds } = await useMultiFileAuthState('auth_info_baileys');
Â Â 
Â  // ğŸŒ Creazione del socket con configurazione base
Â  const sock = makeWASocket({
Â  Â  auth: state,
Â  Â  printQRInTerminal: true, // Stampa QR nel terminale per scansione
Â  Â  logger: console,
Â  Â  browser: ['VareBot', 'Chrome', '4.0.0'], // Simula un browser
Â  });

Â  // ğŸ“¡ Gestione aggiornamenti connessione
Â  conn.ev.on('connection.update', (update) => {
Â  Â  const { connection, lastDisconnect } = update;
Â  Â Â 
Â  Â  if (connection === 'close') {
Â  Â  Â  const shouldReconnect = lastDisconnect?.error?.output?.statusCode !== DisconnectReason.loggedOut;
Â  Â  Â  console.log('ğŸ”´ Connessione chiusa:', lastDisconnect?.error, 'Riconnessione:', shouldReconnect);
Â  Â  Â Â 
Â  Â  Â  if (shouldReconnect) {
Â  Â  Â  Â  startBot(); // Riconnessione automatica
Â  Â  Â  }
Â  Â  } else if (connection === 'open') {
Â  Â  Â  console.log('ğŸŸ¢ Connesso con successo!');
Â  Â  }
Â  });

Â  // ğŸ’¾ Salva credenziali automaticamente
Â  conn.ev.on('creds.update', saveCreds);
}

startBot().catch(console.error);
```

### Gestione Messaggi Base con LID/JID

```typescript
import makeWASocket, { getSenderLid, toJid, getCacheStats, validateJid, Logger } from 'based';

// ... (codice di creazione sock qui)

conn.ev.on('messages.upsert', ({ messages }) => {
Â  for (const msg of messages) {
Â  Â  // ğŸ” Estrai LID del mittente con validazione
Â  Â  const info = getSenderLid(msg);
Â  Â Â 
Â  Â  // âœ… Valida JID prima di usarlo
Â  Â  const validation = validateJid(info.jid);
Â  Â  if (!validation.isValid) {
Â  Â  Â  Logger.error('JID non valido:', validation.error);
Â  Â  Â  continue;
Â  Â  }
Â  Â Â 
Â  Â  const jid = toJid(info.lid); // Normalizza in JID
Â  Â Â 
Â  Â  Logger.info('ğŸ’¬ Messaggio da:', jid, 'Valid:', info.isValid);
Â  Â  console.log('ğŸ“ Contenuto:', msg.message?.conversation);
Â  Â Â 
Â  Â  // Rispondi automaticamente solo se valido
Â  Â  if (info.isValid) {
Â  Â  Â  conn.sendMessage(jid, { text: 'Messaggio ricevuto!' });
Â  Â  }
Â  }
Â Â 
Â  // ğŸ“Š Monitora performance cache
Â  const stats = getCacheStats();
Â  Logger.performance('Cache stats:', stats);
});
```

---

## ğŸ“š Documentazione API

Questa sezione espande i metodi principali, con esempi dettagliati e parametri. Tutti i metodi sono tipizzati in TypeScript per un'esperienza di sviluppo sicura.

### ğŸ—ï¸ Metodi Fondamentali

<details>
<summary><strong>ğŸ“¡ makeWASocket(config)</strong></summary>

Crea un'istanza del socket WhatsApp. Ãˆ il punto di ingresso principale.

**Parametri:**
- `config`: Oggetto con opzioni (vedi sezione Configurazione Avanzata per dettagli completi).

**Restituisce:** Istanza del socket con metodi come `sendMessage` e `ev` per eventi.

**Esempio:**
```typescript
const sock = makeWASocket({
Â  auth: state,
Â  printQRInTerminal: true,
Â  logger: console,
Â  browser: ['Varebot', 'Chrome', '4.0.0'],
});
```
</details>

<details>
<summary><strong>ğŸ” useMultiFileAuthState(folder)</strong></summary>

Gestisce l'autenticazione persistente salvando credenziali in file multipli per sicurezza.

**Parametri:**
- `folder`: Stringa, path della cartella per i file di auth (es. 'auth_info').

**Restituisce:**
- `{ state, saveCreds }`: Stato autenticazione e funzione per salvare aggiornamenti.

**Esempio:**
```typescript
const { state, saveCreds } = await useMultiFileAuthState('auth_info');
conn.ev.on('creds.update', saveCreds); // Integra nel socket
```
</details>

<details>
<summary><strong>ğŸ”„ getSenderLid(message) & toJid(lid)</strong></summary>

UtilitÃ  per gestire LID/JID, risolvendo problemi comuni in gruppi e multi-dispositivo.

**getSenderLid(message):**
- Estrae LID dal messaggio.
- Restituisce: Oggetto con `lid` e altre info mittente.

**toJid(lid):**
- Converte LID in JID normalizzato (es. aggiunge `@s.whatsapp.net`).

**Esempio:**
```typescript
const info = getSenderLid(msg);
const jid = toJid(info.lid);
conn.sendMessage(jid, { text: 'Risposta personalizzata' });
```
</details>

<details>
<summary><strong>ğŸ“¤ sendMessage(jid, content, options)</strong></summary>

Invia messaggi di vari tipi. Supporta testo, media, interattivi.

**Parametri:**
- `jid`: Stringa JID del destinatario.
- `content`: Oggetto messaggio (es. { text: 'Ciao' }).
- `options`: Opzionale, include `quoted`, `mentions`, ecc.

**Esempio Testo Semplice:**
```typescript
await conn.sendMessage(jid, { text: 'Ciao Mondo!' });
```
</details>

### ğŸ¯ Eventi Principali

| EventoÂ  Â  Â  Â  Â  Â  Â  | DescrizioneÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  | Callback SignatureÂ  Â  Â  Â  Â  |
|---------------------|--------------------------------------|-----------------------------|
| `connection.update` | Aggiornamenti stato connessioneÂ  Â  Â | `(update: Partial<ConnectionState>) => void` |
| `creds.update`Â  Â  Â  | Aggiornamento credenzialiÂ  Â  Â  Â  Â  Â | `() => void`Â  Â  Â  Â  Â  Â  Â  Â  |
| `messages.upsert`Â  Â | Nuovi messaggi o aggiornamentiÂ  Â  Â  Â | `({ messages: WAMessage[], type: MessageUpsertType }) => void` |
| `messages.update`Â  Â | Modifiche a messaggi esistentiÂ  Â  Â  Â | `(update: WAMessageUpdate[]) => void` |
| `group-participants.update` | Cambiamenti partecipanti gruppo | `(update: GroupParticipantEvent) => void` |

**Esempio Registrazione Evento:**
```typescript
conn.ev.on('group-participants.update', (update) => {
Â  console.log('Partecipante aggiornato:', update);
});
```

---

## ğŸª Messaggi Interattivi e Bottoni

### Metodi per Messaggi Non Interattivi

Questi metodi inviano contenuti semplici senza elementi cliccabili.

#### Messaggi di Testo
Invia un messaggio di testo semplice, con supporto per menzioni.

```typescript
await conn.sendMessage(jid, {Â 
Â  text: 'finchevedotuttoviolaviola',Â 
Â  mentions: ['393476686131@s.whatsapp.net']Â 
});
```

#### Messaggi Immagine
Invia un'immagine con caption opzionale.

```typescript
await conn.sendMessage(jid, {Â 
Â  image: { url: 'https://i.ibb.co/hJW7Wwx/varebot.jpg' },Â 
Â  caption: 'out soon!'Â 
});
```

#### Messaggi Video
Invia un video con caption e mimetype.

```typescript
await conn.sendMessage(jid, {Â 
Â  video: { url: 'https://example.com/video.mp4' },Â 
Â  caption: 'peak!',Â 
Â  mimetype: 'video/mp4'Â 
});
```

#### Messaggi Audio
Invia un file audio (nota vocale o file).

```typescript
await conn.sendMessage(jid, {Â 
Â  audio: { url: 'https://esempio.com/audio.ogg' },Â 
Â  mimetype: 'audio/ogg; codecs=opus'Â 
});
```

#### Messaggi Documento
Invia un documento con titolo e descrizione.

```typescript
await conn.sendMessage(jid, {Â 
Â  document: { url: 'https://esempio.com/file.pdf' },Â 
Â  mimetype: 'application/pdf',Â 
Â  fileName: 'documento.pdf',Â 
Â  fileLength: 1024Â 
});
```

#### Messaggi Sticker
Invia uno sticker (animato o statico).

```typescript
await conn.sendMessage(jid, {Â 
Â  sticker: { url: 'https://i.ibb.co/4nxpDtTS/shhh2.webp' },Â 
Â  mimetype: 'image/webp'Â 
});
```

#### Messaggi Posizione
Invia una posizione geografica.

```typescript
await conn.sendMessage(jid, {Â 
Â  location: {Â 
Â  Â  degreesLatitude: 45.4642,Â 
Â  Â  degreesLongitude: 9.1900,Â 
Â  Â  name: 'Milano, Italia'Â 
Â  }Â 
});
```

#### Messaggi Contatto
Invia un vCard di un contatto.

```typescript
await conn.sendMessage(jid, {Â 
Â  contacts: {Â 
Â  Â  displayName: 'Sam aka vare',Â 
Â  Â  contacts: [{ vcard: 'BEGIN:VCARD\nVERSION:3.0\nFN:Sam\nTEL;waid=393476686131:+39 347 6686131\nEND:VCARD' }]Â 
Â  }Â 
});
```

#### Messaggi Poll (Sondaggio)
Invia un sondaggio con opzioni.

```typescript
await conn.sendMessage(jid, {Â 
Â  poll: {Â 
Â  Â  name: 'Anime preferito?',Â 
Â  Â  values: ['Aot', 'Bleach', 'Death note'],Â 
Â  Â  selectableCount: 1Â // quante scelte possibili
Â  }Â 
});
```

#### Reazioni ai Messaggi
Aggiunge una reazione a un messaggio esistente.

```typescript
await conn.sendMessage(jid, {Â 
Â  react: {Â 
Â  Â  text: 'ğŸ¥',Â 
Â  Â  key: msg.keyÂ  // Key del messaggio da reagire
Â  }Â 
});
```

#### Album (Multi-Media)
Invia un album di immagini/video misti.

```typescript
await conn.sendMessage(jid, {
Â  album: [
Â  Â  { image: { url: 'img1.jpg' }, caption: 'Foto 1' },
Â  Â  { video: { url: 'vid1.mp4' }, caption: 'Video 1' },
Â  ],
});
```

### Metodi per Messaggi Interattivi

Questi messaggi includono elementi interattivi come bottoni, liste e template.

#### Messaggi con Bottoni Semplici
Invia bottoni di risposta rapida.

```typescript
await conn.sendMessage(jid, {
Â  text: 'Scegli un\'opzione:',
Â  footer: 'Footer',
Â  buttons: [
Â  Â  { buttonId: 'cmd1', buttonText: { displayText: 'testo1' }, type: 1 },
Â  Â  { buttonId: 'cmd2', buttonText: { displayText: 'testo2' }, type: 1 },
Â  ],
Â  headerType: 1,
});
```

#### Messaggi con Bottoni e Immagine
Combina immagine con bottoni.

```typescript
await conn.sendMessage(jid, {
Â  image: { url: 'https://i.ibb.co/hJW7Wwx/varebot.jpg' },
Â  caption: 'Messaggio con bottoni e immagine',
Â  footer: 'vare âœ§ bot',
Â  buttons: [
Â  Â  { buttonId: 'cmd', buttonText: { displayText: 'testo1' }, type: 1 },
Â  ],
});
```

#### Messaggi Liste (Sezioni)
Invia una lista di opzioni (solo in privato).

```typescript
await conn.sendMessage(jid, {
Â  text: 'Questa Ã¨ una lista!',
Â  footer: 'purplepurplepurple!',
Â  title: 'Titolo Lista',
Â  buttonText: 'Visualizza Lista',
Â  sections: [
Â  Â  {Â 
Â  Â  Â  title: 'Sezione 1',Â 
Â  Â  Â  rows: [Â 
Â  Â  Â  Â  { title: 'Opzione 1', rowId: 'opt1' },Â 
Â  Â  Â  Â  { title: 'Opzione 2', rowId: 'opt2', description: 'Descrizione' }Â 
Â  Â  Â  ]Â 
Â  Â  },
Â  ],
});
```

#### Messaggi Carousel (Cards)
Invia un carousel di carte con bottoni URL.

```typescript
await conn.sendMessage(jid, {
Â  text: 'ã€– ğŸŒ¸ ã€— Benvenuto in VareBot!',
Â  title: '',
Â  footer: '',
Â  cards: [
Â  Â  {
Â  Â  Â  image: { url: 'https://i.ibb.co/hJW7Wwx/varebot.jpg' },
Â  Â  Â  title: 'by sam aka vare',
Â  Â  Â  body: 'ã€– ğŸ’« ã€— Esplora funzionalitÃ \nã€– ğŸš€ ã€— Bot aggiornato',
Â  Â  Â  footer: 'Ë—ËË‹ â˜¾ ğšŸğšŠğš›ğšğš‹ğš˜ğš â˜½ ËËŠË—',
Â  Â  Â  buttons: [
Â  Â  Â  Â  { name: 'cta_url', buttonParamsJson: JSON.stringify({ display_text: 'Sito VareBot', url: 'https://varebot.netlify.app' }) },
Â  Â  Â  Â  { name: 'cta_url', buttonParamsJson: JSON.stringify({ display_text: 'ğŸ’» GitHub', url: 'https://github.com/realvare' }) },
Â  Â  Â  Â  { name: 'cta_url', buttonParamsJson: JSON.stringify({ display_text: 'ğŸ’¬ WhatsApp', url: 'https://wa.me/393476686131' }) },
Â  Â  Â  Â  { name: 'cta_url', buttonParamsJson: JSON.stringify({ display_text: 'ğŸ“¸ Instagram', url: 'https://instagram.com/samakavare' }) },
Â  Â  Â  Â  { name: 'cta_url', buttonParamsJson: JSON.stringify({ display_text: 'ğŸ“§ Email', url: 'mailto:samakavare1@gmail.com' }) },
Â  Â  Â  ],
Â  Â  },
Â  ],
}, { quoted: m });
```

> **Nota:** Per tutti i messaggi interattivi, assicurati di gestire le risposte nei listener `messages.upsert` verificando `msg.message.buttonsResponseMessage` o simili per estrarre le selezioni.

---

## ğŸ”§ Fix LID/JID nel Proprio Main e Handler

Il supporto LID/JID Ã¨ un punto di forza di questa libreria, risolvendo problemi comuni come l'identificazione mittenti in gruppi e multi-dispositivo. Ecco come integrarlo nel tuo codice principale e handler, basandomi sui metodi estratti dai file forniti (main.js, handler.js e print.js).

### Best Practices per LID/JID

- **decodeJid(jid)**: Funzione principale per normalizzare JID/LID. Gestisce:
  - Formati con `:\d+@` (usa `jidNormalizedUser`).
  - Decodifica user/server in `${user}@${server}`.
  - Converti `@lid` in `@s.whatsapp.net`.
  
  **Esempio di Implementazione (da main.js):**
  ```typescript
  decodeJid: (jid) => {
      if (!jid) return jid;
      let decoded = jid;
      if (/:\d+@/gi.test(jid)) {
          decoded = jidNormalizedUser(jid);
      }
      if (typeof decoded === 'object' && decoded.user && decoded.server) {
          decoded = `${decoded.user}@${decoded.server}`;
      }
      if (decoded.endsWith('@lid')) {
          decoded = decoded.replace('@lid', '@s.whatsapp.net');
      }
      return decoded;
  },
  ```
  Usa `conn.decodeJid(jid)` ovunque per normalizzare IDs (es. sender, participant, quoted).

- **Monkey-Patch per groupParticipantsUpdate**: Corregge aggiornamenti partecipanti gruppo trovando il JID reale dal metadata.
  
  **Esempio (da handler.js):**
  ```typescript
  if (!this.originalGroupParticipantsUpdate) {
      this.originalGroupParticipantsUpdate = this.groupParticipantsUpdate;
      this.groupParticipantsUpdate = async function(chatId, users, action) {
          try {
              let metadata = global.groupCache.get(chatId);
              if (!metadata) {
                  metadata = await fetchGroupMetadataWithRetry(this, chatId);
                  if (metadata) global.groupCache.set(chatId, metadata);
              }
              if (!metadata) {
                  console.error('[ERRORE] Nessun metadato del gruppo disponibile per un aggiornamento sicuro');
                  return this.originalGroupParticipantsUpdate.call(this, chatId, users, action);
              }

              const correctedUsers = users.map(userJid => {
                  const decoded = this.decodeJid(userJid);
                  const phone = decoded.split('@')[0].split(':')[0];
                  const participant = metadata.participants.find(p => {
                      const pId = this.decodeJid(p.id || p.jid || '');
                      const pPhone = pId.split('@')[0].split(':')[0];
                      return pPhone === phone;
                  });
                  return participant ? participant.id : userJid; // Fallback all'originale se non trovato
              });

              return this.originalGroupParticipantsUpdate.call(this, chatId, correctedUsers, action);
          } catch (e) {
              console.error('[ERRORE] Errore in safeGroupParticipantsUpdate:', e);
              throw e;
          }
      };
  }
  ```

- **Cache per Metadata Gruppo e Admin**: Usa NodeCache per memorizzare metadata e admin, normalizzando con `decodeJid`.
  
  **Esempio (da handler.js):**
  ```typescript
  global.groupCache = new NodeCache({ stdTTL: 5 * 60, useClones: false });
  global.adminCache = new NodeCache({ stdTTL: 5 * 60, useClones: false });

  // In participantsUpdate o groups.update:
  metadata.participants.forEach(u => {
      const normId = this.decodeJid(u.id);
      const jid = u.jid || normId;
      if (u.admin === 'admin' || u.admin === 'superadmin') {
          adminSet.add(jid);
          if (jid !== normId) adminSet.add(normId);
      }
  });
  metadata.admins = Array.from(adminSet);
  global.groupCache.set(update.id, metadata);
  ```

- **Normalizzazione in Print/Log**: Rimuovi `:xx` dai numeri telefono per clean display.
  
  **Esempio (da print.js):**
  ```typescript
  function formatPhoneNumber(jid, name) {
      if (!jid) return 'Sconosciuto';
      let userPart = jid.split('@')[0];
      let cleanNumber = userPart.split(':')[0]; // Rimuovi la parte :xx per ottenere il numero reale
      try {
          const number = PhoneNumber('+' + cleanNumber).getNumber('international');
          return number + (name ? ` ~${name}` : '');
      } catch {
          return (cleanNumber || '') + (name ? ` ~${name}` : '');
      }
  }
  ```

- **Problemi Comuni e Fix:**
  - **LID Mancante in Gruppi:** Usa `decodeJid` e cache metadata per trovare JID reali.
  - **Conversione JID:** Sempre applica `decodeJid` prima di `sendMessage` o query.
  - **Multi-Dispositivo:** Imposta `syncFullHistory: true` in config per sync LID.
  - **Errori in Mention/Quoted:** Normalizza con `decodeJid` in handler per quoted.sender e mentionedJid.

### Esempio Integrato in Main

```typescript
// Nel tuo file main
import makeWASocket, { getSenderLid, toJid } from 'based';
// ... (autenticazione e creazione sock)

conn.ev.on('messages.upsert', async ({ messages }) => {
Â  const msg = messages[0];
Â  if (!msg.message) return;

Â  const info = getSenderLid(msg);
Â  const senderJid = toJid(info.lid); // Fix LID -> JID

Â  // Esempio: Rispondi solo se JID valido
Â  if (senderJid.endsWith('@s.whatsapp.net')) {
Â  Â  await conn.sendMessage(senderJid, { text: `Ciao da ${senderJid}!` }, { quoted: msg });
Â  }
});
```

### Esempio Handler Personalizzato

Crea un handler separato per modularitÃ :

```typescript
// handler.js
export async function handleMessage(sock, msg) {
Â  const info = getSenderLid(msg);
Â  const jid = toJid(info.lid);
Â Â 
Â  // Log e risposta
Â  console.log(`Messaggio da ${jid}`);
Â  await conn.sendMessage(jid, { text: 'Handler attivato!' });
}

// Nel main: conn.ev.on('messages.upsert', ({ messages }) => handleMessage(sock, messages[0]));
```

**Consiglio:** Testa in gruppi per verificare LID, poichÃ© Baileys upstream ha migliorato il supporto nativo nel 2025, ma i fix personalizzati qui garantiscono retrocompatibilitÃ .

---

## âš¡ Nuove FunzionalitÃ  Performance (v2.5.0+)

### ğŸš€ Cache Intelligente LID/JID

La libreria ora include un sistema di cache avanzato per ottimizzare le conversioni LID/JID:

```typescript
import { getCacheStats, clearCache, setPerformanceConfig } from 'based';

// Configura cache personalizzata
setPerformanceConfig({
Â  Â  cache: {
Â  Â  Â  Â  lidCache: {
Â  Â  Â  Â  Â  Â  ttl: 10 * 60 * 1000, // 10 minuti
Â  Â  Â  Â  Â  Â  maxSize: 15000
Â  Â  Â  Â  }
Â  Â  }
});

// Monitora performance
const stats = getCacheStats();
console.log('Cache LID:', stats.lidCache.size, '/', stats.lidCache.maxSize);

// Pulisci cache se necessario
clearCache();
```

### ğŸ›¡ï¸ Validazione JID Avanzata

```typescript
import { validateJid, Logger } from 'based';

const jid = '1234567890@s.whatsapp.net';
const validation = validateJid(jid);

if (validation.isValid) {
Â  Â  Logger.info('JID valido:', jid);
} else {
Â  Â  Logger.error('JID non valido:', validation.error);
}
```

### ğŸ“Š Logging Condizionale

```typescript
import { Logger, setPerformanceConfig } from 'based';

// Configura logging
setPerformanceConfig({
Â  Â  debug: {
Â  Â  Â  Â  enableLidLogging: true,
Â  Â  Â  Â  enablePerformanceLogging: true,
Â  Â  Â  Â  logLevel: 'debug' // 'error', 'warn', 'info', 'debug'
Â  Â  }
});

// Usa logger condizionale
Logger.debug('Debug info');
Logger.performance('Performance metrics');
Logger.error('Error occurred');
```

### ğŸ”§ Configurazione Performance

```typescript
import { setPerformanceConfig, getPerformanceConfig } from 'based';

// Configurazione completa
setPerformanceConfig({
Â  Â  performance: {
Â  Â  Â  Â  enableCache: true,
Â  Â  Â  Â  enableMetrics: true,
Â  Â  Â  Â  batchSize: 100,
Â  Â  Â  Â  maxRetries: 3
Â  Â  },
Â  Â  cache: {
Â  Â  Â  Â  lidCache: { ttl: 5 * 60 * 1000, maxSize: 10000 },
Â  Â  Â  Â  jidCache: { ttl: 5 * 60 * 1000, maxSize: 10000 }
Â  Â  },
Â  Â  debug: {
Â  Â  Â  Â  enableLidLogging: false,
Â  Â  Â  Â  logLevel: 'warn'
Â  Â  }
});

// Ottieni configurazione corrente
const config = getPerformanceConfig();
console.log('Cache abilitata:', config.performance.enableCache);
```

---

## ğŸ§© Eventi: LID e JID sempre disponibili (nuovo)

Gli eventi emessi includono campi ausiliari sui messaggi per accedere facilmente sia al JID sia al LID del mittente/partecipante.

```typescript
conn.ev.on('messages.upsert', ({ messages, type }) => {
  for (const msg of messages) {
    // Campi aggiuntivi su msg.key
    // - remoteJidNormalized: JID normalizzato (es. @s.whatsapp.net)
    // - remoteLid: LID equivalente del remoteJid
    // - participantLid: LID equivalente del participant (se presente)
    const jid = msg.key.remoteJidNormalized || msg.key.remoteJid;
    const remoteLid = msg.key.remoteLid;
    const participantLid = msg.key.participantLid;

    if (jid?.endsWith('@s.whatsapp.net')) {
      conn.sendMessage(jid, { text: `Ciao! LID: ${remoteLid || 'n/d'}` });
    }
  }
});
```

Questi campi eliminano ambiguitÃ  in gruppi e contesti multi-dispositivo dove alcuni eventi riportano LID, altri JID.

---

## âš™ï¸ Configurazione Avanzata

Personalizza il socket per performance e comportamento.

### ğŸ”§ Opzioni Complete per makeWASocket

```typescript
const sock = makeWASocket({
Â  // ğŸ” Autenticazione
Â  auth: state,
Â Â 
Â  // ğŸ–¥ï¸ UI e Debug
Â  printQRInTerminal: true,
Â  logger: console, // Usa Pino per logging avanzato
Â  browser: ['VareBot', 'Chrome', '4.0.0'],
Â Â 
Â  // â±ï¸ Timeout e Connessione
Â  defaultQueryTimeoutMs: 60000,
Â  keepAliveIntervalMs: 30000,
Â  connectTimeoutMs: 60000,
Â  retryRequestDelayMs: 250,
Â  maxMsgRetryCount: 5,
Â Â 
Â  // ğŸ›ï¸ Comportamento
Â  markOnlineOnConnect: true,
Â  syncFullHistory: false, // Attiva per sync completo (consuma dati)
Â  fireInitQueries: true,
Â  generateHighQualityLinkPreview: true, // Anteprime link HD
});
```

### ğŸ›¡ï¸ Sicurezza e Crittografia

| CaratteristicaÂ  Â  Â  Â  Â  Â  | DescrizioneÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  |
|---------------------------|------------------------------------------|
| ğŸ” End-to-End Encryption | Protocollo Signal per messaggi sicuriÂ  Â |
| ğŸ”‘ Key ManagementÂ  Â  Â  Â  | Generazione/rotazione automatica chiavi |
| ğŸ” AuthenticationÂ  Â  Â  Â  | Sicurezza tramite QR code o pairing code|
| ğŸ›¡ï¸ Data ProtectionÂ  Â  Â  Â | Archiviazione sicura credenziali locali |

---
<div align="center">


## ğŸŒ Supporto e Community

Unisciti alla community per aiuto e contributi.

### ğŸ“ Contatti e Risorse

| CanaleÂ  Â  Â  Â  Â  | Link/InfoÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  |
|-----------------|----------------------------------------|
| **Email**Â  Â  Â  Â | [samakavare1@gmail.com](mailto:samakavare1@gmail.com) |
| **GitHub Issues**| [Segnala Bug](https://github.com/realvare/based/issues) |
| **PayPal**Â  Â  Â  | [Dona](https://www.paypal.me/samakavare) |
| **Canale whatsapp**| [Canale](https://www.whatsapp.com/channel/0029VbB41Sa1Hsq1JhsC1Z1z) |

---

## ğŸ™ Ringraziamenti

Grazie ai progetti che ispirano Based:

| ProgettoÂ  Â  Â  Â  Â  Â  Â  Â  Â  | ContributoÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  |
|---------------------------|-----------------------------------------|
| [Baileys](https://github.com/WhiskeySockets/Baileys) | API WhatsApp Web originaleÂ  Â  Â  Â  Â  Â  Â |
| [Yupra](https://www.npmjs.com/package/@yupra/baileys) | Fix LID/JID avanzatiÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â |
| [Signal Protocol](https://signal.org/) | Crittografia end-to-endÂ  Â  Â  Â  Â  Â  Â  Â  |

---

## âš ï¸ Disclaimer & Licenza

### ğŸ“‹ Nota Legale

âš ï¸ **Importante**: Non affiliato a WhatsApp Inc. o Meta. Uso educativo/sviluppo solo.

ğŸ›¡ï¸ **Uso Responsabile**: Evita spam, violazioni ToS WhatsApp. Rischio ban account.

### ğŸ“œ Licenza MIT

MIT License Â© 2025 [realvare](https://github.com/realvare)

Vedi [LICENSE](LICENSE) per dettagli.

---

<div align="center">

<img src="https://i.ibb.co/Cp0SQznC/sam2.png" width="160" height="160" alt="realvare profile picture"/>

### Creato da [realvare](https://github.com/realvare)

<p>
Â  <a href="https://github.com/realvare/based"><img src="https://img.shields.io/badge/â­_Stella_il_Progetto-8a2be2?style=for-the-badge&logo=github&logoColor=white"/></a>
Â  <a href="https://github.com/realvare/based/fork"><img src="https://img.shields.io/badge/ğŸ”„_Fork_Repository-8a2be2?style=for-the-badge&logo=github&logoColor=white"/></a>
</p>

<p>
Â  <img src="https://img.shields.io/github/contributors/realvare/based?style=for-the-badge&color=8a2be2&labelColor=2d1b69" alt="Contributori"/>
Â  <img src="https://img.shields.io/github/last-commit/realvare/based?style=for-the-badge&color=8a2be2&labelColor=2d1b69" alt="Ultimo Commit"/>
</p>

**Se ti Ã¨ stato utile, valuta di lasciare una stella o di [donare](https://paypal.me/samakavare)!**

</div>
